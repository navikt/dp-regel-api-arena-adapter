#######################################
#!/usr/bin/env bash
#
# Script for setting a job running uat tests
#
# Requirements: 
# - kubectl in path.
#######################################

set -o errexit
set -o pipefail
[[ "${DEBUG}" == 'true' ]] && set -o xtrace


kubectl config use-context dev-fss

kubectl delete -k tests/uat --ignore-not-found=true

kubectl apply -k tests/uat 

#Job name is based upon namePrefix set in the overlay and the resource name in the base.
kubectl -n dagpenger-test wait --for=condition=complete --timeout=300s job/dp-regel-api-arena-adapter-funksjonelle-tester

#app label is set in the overlay
kubectl -n dagpenger-test logs -l app=dp-regel-api-arena-adapter --tail=1000



